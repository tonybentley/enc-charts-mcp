<!DOCTYPE html>
<html>
<head>
    <title>San Diego Bay Coastline Render</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        #map {
            width: 100%;
            height: 700px;
            border: 3px solid #333;
            margin: 20px 0;
            display: block;
            background: white;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .info {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        h1 {
            margin-top: 0;
            color: #333;
        }
        .stats {
            display: flex;
            gap: 30px;
            margin-top: 15px;
        }
        .stat {
            flex: 1;
            text-align: center;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 4px;
        }
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #2c5aa0;
        }
        .stat-label {
            font-size: 14px;
            color: #666;
            margin-top: 5px;
        }
        .legend {
            margin-top: 20px;
            display: flex;
            gap: 20px;
            justify-content: center;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .legend-color {
            width: 20px;
            height: 3px;
            background: #000080;
        }
        .legend-marker {
            width: 12px;
            height: 12px;
            background: red;
            border-radius: 50%;
            border: 2px solid white;
            box-shadow: 0 0 2px rgba(0,0,0,0.5);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="info">
            <h1>San Diego Bay Coastline Extraction Test</h1>
            <p><strong>Target Location:</strong> Shelter Island (32.714935°, -117.228975°)</p>
            <p><strong>Expected Result:</strong> Peninsula shape extending into San Diego Bay</p>
            <p><strong>Data Source:</strong> NOAA ENC Chart - S-57 COALNE features</p>
            
            <div class="stats">
                <div class="stat">
                    <div class="stat-value" id="total-features">0</div>
                    <div class="stat-label">Total Features</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="near-shelter">0</div>
                    <div class="stat-label">Near Shelter Island</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="total-points">0</div>
                    <div class="stat-label">Coordinate Points</div>
                </div>
            </div>
            
            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color"></div>
                    <span>Coastline</span>
                </div>
                <div class="legend-item">
                    <div class="legend-marker"></div>
                    <span>Shelter Island Center</span>
                </div>
            </div>
        </div>
        
        <canvas id="map"></canvas>
    </div>
    
    <script src="coastline-data.js"></script>
    <script>
        // Canvas setup
        const canvas = document.getElementById('map');
        const ctx = canvas.getContext('2d');
        
        // Set canvas size
        const rect = canvas.getBoundingClientRect();
        canvas.width = rect.width;
        canvas.height = 700;
        
        // Map bounds focusing on Shelter Island area
        const bounds = {
            minLon: -117.25,
            maxLon: -117.20,
            minLat: 32.70,
            maxLat: 32.73
        };
        
        // Shelter Island location
        const shelterIsland = {
            lat: 32.714935,
            lon: -117.228975
        };
        
        // Convert lat/lon to canvas coordinates
        function toCanvas(lon, lat) {
            const x = ((lon - bounds.minLon) / (bounds.maxLon - bounds.minLon)) * canvas.width;
            const y = canvas.height - ((lat - bounds.minLat) / (bounds.maxLat - bounds.minLat)) * canvas.height;
            return { x, y };
        }
        
        // Render coastlines
        function render() {
            // Clear with water color
            ctx.fillStyle = '#87CEEB';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Draw coordinate grid
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.3)';
            ctx.lineWidth = 1;
            
            // Grid lines every 0.01 degrees
            for (let lon = Math.ceil(bounds.minLon * 100) / 100; lon <= bounds.maxLon; lon += 0.01) {
                const start = toCanvas(lon, bounds.minLat);
                const end = toCanvas(lon, bounds.maxLat);
                ctx.beginPath();
                ctx.moveTo(start.x, start.y);
                ctx.lineTo(end.x, end.y);
                ctx.stroke();
            }
            
            for (let lat = Math.ceil(bounds.minLat * 100) / 100; lat <= bounds.maxLat; lat += 0.01) {
                const start = toCanvas(bounds.minLon, lat);
                const end = toCanvas(bounds.maxLon, lat);
                ctx.beginPath();
                ctx.moveTo(start.x, start.y);
                ctx.lineTo(end.x, end.y);
                ctx.stroke();
            }
            
            // Statistics
            let totalFeatures = 0;
            let nearShelterCount = 0;
            let totalPoints = 0;
            const tolerance = 0.015; // ~1.5km
            
            // Draw coastlines
            ctx.strokeStyle = '#000080';
            ctx.lineWidth = 2.5;
            
            coastlineData.features.forEach(feature => {
                if (feature.geometry && feature.geometry.type === 'LineString') {
                    const coords = feature.geometry.coordinates;
                    if (coords && coords.length > 0) {
                        totalFeatures++;
                        totalPoints += coords.length;
                        
                        // Check if near Shelter Island
                        let isNear = false;
                        for (let coord of coords) {
                            const lon = coord[0];
                            const lat = coord[1];
                            if (Math.abs(lat - shelterIsland.lat) < tolerance && 
                                Math.abs(lon - shelterIsland.lon) < tolerance) {
                                isNear = true;
                                break;
                            }
                        }
                        
                        if (isNear) {
                            nearShelterCount++;
                            ctx.strokeStyle = '#0000FF'; // Bright blue for near features
                            ctx.lineWidth = 3;
                        } else {
                            ctx.strokeStyle = '#000080'; // Navy for other features
                            ctx.lineWidth = 2;
                        }
                        
                        // Draw the line
                        ctx.beginPath();
                        const firstPoint = toCanvas(coords[0][0], coords[0][1]);
                        ctx.moveTo(firstPoint.x, firstPoint.y);
                        
                        for (let i = 1; i < coords.length; i++) {
                            const point = toCanvas(coords[i][0], coords[i][1]);
                            ctx.lineTo(point.x, point.y);
                        }
                        
                        ctx.stroke();
                    }
                }
            });
            
            // Draw Shelter Island marker
            const shelterPoint = toCanvas(shelterIsland.lon, shelterIsland.lat);
            
            // White background circle
            ctx.fillStyle = 'white';
            ctx.beginPath();
            ctx.arc(shelterPoint.x, shelterPoint.y, 8, 0, 2 * Math.PI);
            ctx.fill();
            
            // Red center
            ctx.fillStyle = 'red';
            ctx.beginPath();
            ctx.arc(shelterPoint.x, shelterPoint.y, 6, 0, 2 * Math.PI);
            ctx.fill();
            
            // Update statistics
            document.getElementById('total-features').textContent = totalFeatures;
            document.getElementById('near-shelter').textContent = nearShelterCount;
            document.getElementById('total-points').textContent = totalPoints;
        }
        
        // Check if data is available and render
        if (typeof coastlineData !== 'undefined') {
            render();
        } else {
            ctx.fillStyle = 'red';
            ctx.font = '20px Arial';
            ctx.fillText('Error: Coastline data not loaded', 50, canvas.height / 2);
        }
        
        // Handle window resize
        window.addEventListener('resize', () => {
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width;
            if (typeof coastlineData !== 'undefined') {
                render();
            }
        });
    </script>
</body>
</html>